<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TinginaEmpire - Uganda's Premier Music Hub</title>
    <link rel="stylesheet" href="./TinginaEmpire.css">
    <link rel="stylesheet" href="./home.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <link rel="icon" href="https://img.icons8.com/color/48/000000/musical-notes.png" />
    <link rel="stylesheet" href="./notifications.css">
    <link rel="stylesheet" href="./custom-dialog.css"> <!-- ADD THIS LINE -->
</head>
<body>
    <header class="main-header">
        <div class="container navbar">
            <a href="./index.html" class="nav-logo"><img src="./logo.jpg" alt="TinginaEmpire Logo"><span class="nav-logo-text">TinginaEmpire</span></a>
            <nav class="nav-links">
                <a href="./index.html" class="active">Home</a>
                <a href="./music.html">Music</a>
                <a href="./band.html">Band</a>
                <a href="./contact.html">Contact</a>
            </nav>
            <div class="hamburger-menu"><i class="fas fa-bars"></i></div>
            <div id="auth-header-section"></div>
        </div>
    </header> 

    <main>
        <!-- Section 1: Redesigned Hero Section (Simplified) -->
        <section class="hero-slideshow-section">
            <div class="slideshow-container">
                <div class="slide" style="background-image: url('./Photos/mic.jpg');"></div>
                <div class="slide" style="background-image: url('./Photos/piano.jpg');"></div>
                <div class="slide" style="background-image: url('./Photos/crowd.jpg');"></div>
                <div class="slide active" style="background-image: url('./Photos/dj.jpg');"></div>
            </div>
            <div class="hero-overlay"></div>
            <div class="hero-content">
                <div class="home-hero-content">
                    <h1>Uganda's Premier <span class="highlight">Music Production Hub</span></h1>
                    <p class="subtitle">Where African rhythms meet world-class production. We create, produce, and perform music that moves souls and celebrates our rich cultural heritage.</p>
                    <div class="hero-cta-buttons">
                        <a href="#about-section" class="btn btn-primary"><i class="fas fa-play"></i> Explore Our Services</a>
                        <a href="./music.html" class="btn btn-secondary"><i class="fas fa-users"></i> Meet Our Artists</a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 2: About Section -->
        <section id="about-section" class="section-padding about-section-home">
            <div class="container about-grid">
                <div class="about-story">
                    <h2 style="text-align: left;">About TinginaEmpire</h2>
                    <p>Founded in the heart of Kampala, TinginaEmpire emerged from a vision to create a space where traditional African music meets contemporary production. We believe that music is the universal language that connects hearts and transcends boundaries.</p>
                </div>
                <div class="about-values">
                    <div class="value-card"><div class="icon"><i class="fas fa-record-vinyl"></i></div><h4>Professional Studio</h4><p>State-of-the-art recording and mixing facilities to bring your vision to life.</p></div>
                    <div class="value-card"><div class="icon"><i class="fas fa-heart"></i></div><h4>Cultural Heritage</h4><p>Preserving and promoting Ugandan music traditions for the next generation.</p></div>
                </div>
            </div>
        </section>

        <!-- Section 3: Recently Added Section (Was Trending Tracks) -->
        <section class="section-padding" style="background-color: var(--dark-bg);">
            <div class="container recent-tracks-container">
                <div class="recent-tracks-header">
                    <h2>Recently Added</h2>
                    <p>The latest songs from our featured artists</p>
                </div>
                <div id="recent-tracks-list">
                    <div class="loader-container full-page"><div class="loader"></div></div>
                </div>
                <a href="./music.html" class="view-all-btn">View All Tracks</a>
            </div>
        </section>

        <!-- Section 4: Final Call-to-Action -->
        <div class="container">
            <section class="cta-section">
                <h2>Ready to Start Your Journey?</h2>
                <p>Whether you're an artist looking to record or an organizer seeking live entertainment, we're ready to collaborate.</p>
                <div class="hero-cta-buttons cta-buttons">
                    <a href="./contact.html" class="btn btn-dark"><i class="fas fa-envelope"></i> Get In Touch</a>
                    <a href="./music.html" class="btn btn-light">Explore Music</a>
                </div>
            </section>
        </div>

        <!-- music player -->
        <div id="music-player">
        <div id="player-song-info">
            <img id="player-artwork" src="https://via.placeholder.com/60?text=TE" alt="Song Artwork">
            <div class="details"><p id="player-title" class="title">Select a song</p><p id="player-artist" class="artist">to start playing</p></div>
        </div>
        <div id="player-controls">
            <div class="player-buttons">
                <button id="prev-btn" title="Previous"><i class="fas fa-step-backward"></i></button>
                <button id="play-pause-btn" title="Play/Pause"><i class="fas fa-play"></i></button>
                <button id="next-btn" title="Next"><i class="fas fa-step-forward"></i></button>
            </div>
            <div id="player-progress-container">
                <span id="current-time">0:00</span>
                <div id="progress-bar-wrapper"><div id="progress-bar"></div></div>
                <span id="duration">0:00</span>
            </div>
        </div>
        <div id="player-extra-controls">
            <button id="player-like-btn" class="like-btn" title="Like Song"><i class="far fa-heart"></i></button>
            <div id="player-volume-container">
                <i id="volume-icon" class="fas fa-volume-up"></i>
                <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="1">
            </div>
            <a href="#" id="player-download-btn" target="_blank" download title="Download Song"><i class="fas fa-download"></i></a>
        </div>
        <audio id="audio-source"></audio>
        </div>
    </main>
    <footer class="main-footer">© 2025 TinginaEmpire - One Voice One Stand. All Rights Reserved.</footer>    
    <div id="auth-modal" class="modal-bg">
        <div class="modal-content">
            <button class="modal-close-btn">×</button>
            <div class="auth-modal-tabs"><button class="auth-modal-tab active" data-form="login">Login</button><button class="auth-modal-tab" data-form="signup">Sign Up</button></div>
            <div id="login-form-container" class="form-container active"><h3>Welcome Back</h3><form id="login-form"><div class="form-group"><label for="login-email">Email</label><input type="email" id="login-email" required></div><div class="form-group"><label for="login-password">Password</label><input type="password" id="login-password" required></div><button type="submit" class="form-submit-btn">Login</button><div class="feedback-message" style="display: none;"></div></form></div>
            <div id="signup-form-container" class="form-container"><h3>Create Account</h3><form id="signup-form"><div class="form-group"><label for="signup-username">Username</label><input type="text" id="signup-username" required></div><div class="form-group"><label for="signup-email">Email</label><input type="email" id="signup-email" required></div><div class="form-group"><label for="signup-password">Password</label><input type="password" id="signup-password" minlength="6" required></div><button type="submit" class="form-submit-btn">Sign Up</button><div class="feedback-message" style="display: none;"></div></form></div>
            <p class="social-login-text">or continue with</p><button class="google-login-btn"><i class="fab fa-google"></i> Login with Google</button>
        </div>
    </div>
    <div id="custom-confirm-modal" class="modal-bg">
        <div class="modal-content">
            <div class="confirm-icon"><i class="fas fa-question-circle"></i></div>
            <h3 id="custom-confirm-title">Confirmation</h3>
            <p id="custom-confirm-message">Are you sure you want to proceed?</p>
            <div class="confirm-buttons">
                <button class="btn btn-cancel">Cancel</button>
                <button class="btn btn-confirm">Confirm</button>
            </div>
        </div>
    </div>
</div>
</body>
<!-- The Correct and Final Script Setup -->
<script src="./live-api.js"></script>
<script src="./auth.js"></script>
<script src="./component-renderer.js"></script>
<script src="./notifications.js"></script>
<script src="./custom-dialog.js"></script> <!-- ADD THIS LINE -->
<script src="./player.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Auth and Player are globally available and self-initializing.

    // --- State Management ---
    let allSongs = [], allArtists = [], userLikes = [];

    // --- DOM Elements ---
    const recentTracksContainer = document.getElementById('recent-tracks-list');
    const statsBar = document.getElementById('stats-bar-live');
    const hamburger = document.querySelector('.hamburger-menu');
    const navLinks = document.querySelector('.nav-links');
    const slides = document.querySelectorAll('.hero-slideshow-section .slide');
    const prevBtn = document.querySelector('.hero-slideshow-section .arrow-left');
    const nextBtn = document.querySelector('.hero-slideshow-section .arrow-right');
    
    // --- Slideshow & Hamburger Logic ---
    if (hamburger && navLinks) {
        hamburger.addEventListener('click', () => navLinks.classList.toggle('active'));
    }
    if (slides.length > 0) {
        let currentSlide = 0;
        let slideInterval;
        function showSlide(index) {
            slides.forEach((s, i) => s.classList.toggle('active', i === index));
            currentSlide = index;
        }
        function nextSlide() { showSlide((currentSlide + 1) % slides.length); }
        function prevSlide() { showSlide((currentSlide - 1 + slides.length) % slides.length); }
        function stopSlideshow() { clearInterval(slideInterval); }
        function startSlideshow() {
            stopSlideshow();
            slideInterval = setInterval(nextSlide, 5000);
        }
        if (nextBtn && prevBtn) {
            nextBtn.addEventListener('click', () => { nextSlide(); startSlideshow(); });
            prevBtn.addEventListener('click', () => { prevSlide(); startSlideshow(); });
        }
        showSlide(0);
        startSlideshow();
    }

    // --- Logic to Fetch and Render Page Content ---
    async function loadHomepageData() {
        try {
            userLikes = JSON.parse(localStorage.getItem('tingina_user_likes') || '[]');
            
            [allSongs, allArtists, stats] = await Promise.all([
                LiveAPI.getSongs(),
                LiveAPI.getArtists(),
                LiveAPI.getStats()
            ]);
            
            renderStatsBar(stats);
            renderRecentSongs();
        } catch (error) {
            console.error("Failed to load homepage data:", error);
            if(recentTracksContainer) recentTracksContainer.innerHTML = `<p style="color: var(--red);">Could not load recent songs.</p>`;
            if(statsBar) statsBar.innerHTML = `<p style="color: var(--red);">Could not load stats.</p>`;
        }
    }

    function renderStatsBar(stats) {
        if (!statsBar) return;
        statsBar.innerHTML = `
            <div class="stat-item"><div class="icon"><i class="fas fa-music"></i></div><h3>${stats.song_count || '50'}+</h3><p>Songs Produced</p></div>
            <div class="stat-item"><div class="icon"><i class="fas fa-user-check"></i></div><h3>${stats.artist_count || '10'}+</h3><p>Artists Supported</p></div>
            <div class="stat-item"><div class="icon"><i class="fas fa-play-circle"></i></div><h3>${Math.round((stats.total_plays || 100000) / 1000)}K+</h3><p>Total Plays</p></div>
        `;
    }

    function renderRecentSongs() {
        if (!recentTracksContainer) return;
        const recentPlaylist = allSongs.slice(0, 5);
        recentTracksContainer.innerHTML = `<div class="track-list">${recentPlaylist.map((song, index) => renderTrackRow(song, index + 1, allArtists, userLikes)).join('')}</div>`;
    }

    // --- Event Delegation for Play, Like, and Download ---
    recentTracksContainer.addEventListener('click', async (e) => {
        const row = e.target.closest('.track-row');
        if (!row) return;
        
        const songId = parseInt(row.dataset.songId, 10);
        const song = allSongs.find(s => s.id === songId);
        const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
        
        const isProtectedAction = e.target.closest('.track-play-btn, .like-btn, .download-btn');
        if (isProtectedAction && !currentUser) {
            if (confirm("You need to be logged in for this action. Go to login page?")) {
                window.location.href = './login.html';
            }
            return;
        }

        if (e.target.closest('.track-play-btn')) {
            const recentPlaylist = allSongs.slice(0, 5);
            document.dispatchEvent(new CustomEvent('playSongRequest', { detail: { songId, playlist: recentPlaylist } }));
        }
        
        if (e.target.closest('.download-btn')) {
            if (song) showToast(`Downloading: ${song.title}`);
        }

        if (e.target.closest('.like-btn')) {
            const likeBtn = e.target.closest('.like-btn');
            const isNowLiked = !userLikes.includes(songId);

            likeBtn.classList.toggle('active', isNowLiked);
            likeBtn.querySelector('i').className = `fa-heart ${isNowLiked ? 'fas' : 'far'}`;

            if (isNowLiked) { userLikes.push(songId); showToast('Added to Liked Songs'); } 
            else { userLikes.splice(userLikes.indexOf(songId), 1); showToast('Removed from Liked Songs'); }
            
            localStorage.setItem('tingina_user_likes', JSON.stringify(userLikes));
            await LiveAPI.toggleSongLike(songId, isNowLiked).catch(err => console.error("Failed to sync like:", err));
        }
    });

    // --- Initial Load ---
    loadHomepageData();
});
</script>
</body>
</html>